# å®‰è£…-å¼€å‘ç¯å¢ƒ-dockeræ–¹å¼
> å®˜ç½‘åŸæ–‡ https://github.com/frappe/frappe_docker 

> ç äº‘é•œåƒ https://gitee.com/yiguxianyun/frappe_docker

> ç»ƒä¹ æ–‡ä»¶ https://gitee.com/yiguxianyun/amtf-xx-frappe_docker.git

::: warning æ³¨æ„:
å¼€å‘ç¯å¢ƒç”¨è¿™ç§ devcontainer çš„æ–¹å¼ï¼Œå®‰è£…ã€å¯åŠ¨ç¡®å®æ–¹ä¾¿ï¼Œä½†æ˜¯æ„Ÿè§‰å ç”¨èµ„æºå¾ˆå¤šï¼Œå¾ˆè´¹ç”µâ€¦â€¦

å»ºè®®ç”¨è™šæ‹Ÿæœºå®‰è£…ubuntuçš„æ–¹å¼è¿›è¡Œå¼€å‘

ä¸å»ºè®®ç”¨wslï¼ŒWindows10ä¸­çš„wslï¼Œæ²¡æ³•å¯åŠ¨mysql(windows11å¯èƒ½è¡Œ)(æ’é™¤dockeræ–¹å¼)
:::


## æ‹·è´.devcontainer
ç”¨äºdockerçš„é…ç½®ï¼Œåšäº†ä¸€äº›ä¿®æ”¹
```shell
cp -R devcontainer-example .devcontainer
```

## æ‹·è´vscodeè®¾ç½®æ–‡ä»¶
ç”¨äºè°ƒè¯•çš„åŸºæœ¬é…ç½®
```shell
cp -R development/vscode-example development/.vscode
```

## å®‰è£… Dev Containers æ’ä»¶

## è„šæœ¬æ–¹å¼è¿è¡Œbench / new site
+ éœ€è¦å…ˆæ›´æ¢ä¸‹è½½æºä¸ºå›½å†…é•œåƒï¼šæ‰§è¡Œ`./yuan.sh`

+ 15ç‰ˆæœ¬éœ€è¦é…åˆnode18ï¼Œéœ€è¦å…ˆåˆ‡æ¢ç‰ˆæœ¬
```shell
nvm ls
```
```shell
nvm use 18
```

+ æ‰§è¡Œè„šæœ¬
```shell
python installer.py
```

## édebugæ–¹å¼å¯åŠ¨
```shell
bench start
```

## è®¿é—®
ä¿®æ”¹ `C:\Windows\System32\drivers\etc\hosts` æ–‡ä»¶ï¼Œæ·»åŠ åŸŸåè§£æ
```shell
127.0.0.1 development.localhost
```
è®¿é—® http://development.localhost:8000/

## debugæ–¹å¼å¯åŠ¨
å…ˆè¦å®‰è£…pythonæ‰©å±•

åˆ‡æ¢åˆ° frappe-bench ç›®å½•ï¼Œå‘½ä»¤è¡Œæ‰§è¡Œ
```shell
honcho start \
    socketio \
    watch \
    schedule \
    worker
```

è¿™ç§æ–¹å¼æœ‰bugğŸ‘‡
~~å…ˆè¦å®‰è£…honcho~~
```shell
/workspace/development/frappe-bench/env/bin/pip install honcho
```
~~æ‰¾åˆ°`.vscode/launch.json`æ–‡ä»¶ï¼Œå¯åŠ¨`Honcho SocketIO Watch Schedule Worker`~~


## ä½¿ç”¨äº¤äº’å¼æ§åˆ¶å°è¿›è¡Œå¼€å‘
æ‚¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­å¯åŠ¨ä¸€ä¸ªç®€å•çš„äº¤äº’å¼ shell æ§åˆ¶å°ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```shell
bench --site development.localhost console
```

## åŸºäºJupyterå†…æ ¸å¯åŠ¨VSCodeäº¤äº’å¼æ§åˆ¶å°
å¤ªé«˜çº§äº†ï¼Œç©ä¸è½¬ï¼Œç®—äº†å§â€¦â€¦

å¯åŠ¨VSCodeå‘½ä»¤é¢æ¿ï¼ˆcmd+shift+pæˆ–ctrl+shift+pï¼‰ï¼Œè¿è¡Œå‘½ä»¤`Pythonï¼šé€‰æ‹©è§£é‡Šå™¨ä»¥å¯åŠ¨JupyteræœåŠ¡å™¨`ï¼Œå¹¶é€‰æ‹©`/workspace/development/frappe-bench/env/bin/python`

ç¬¬ä¸€æ­¥æ˜¯å®‰è£…å’Œæ›´æ–°æ‰€éœ€çš„è½¯ä»¶ã€‚é€šå¸¸ï¼Œfrappeæ¡†æ¶å¯èƒ½éœ€è¦è¾ƒæ—§ç‰ˆæœ¬çš„Jupyterï¼Œè€ŒVSCodeå–œæ¬¢å¿«é€Ÿç§»åŠ¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

```shell
/workspace/development/frappe-bench/env/bin/python -m pip install --upgrade jupyter ipykernel ipython
```

ç„¶åï¼Œä»VSCodeå‘½ä»¤é¢æ¿è¿è¡Œå‘½ä»¤`Python: Show Python interactive window`

å°†`development.localhost`æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ç½‘ç«™ï¼Œå¹¶åœ¨Jupyterå•å…ƒæ ¼ä¸­è¿è¡Œä»¥ä¸‹ä»£ç ï¼š
```shell
import frappe

frappe.init(site='development.localhost', sites_path='/workspace/development/frappe-bench/sites')
frappe.connect()
frappe.local.lang = frappe.db.get_default('lang')
frappe.db.connect()
```
ç¬¬ä¸€ä¸ªå‘½ä»¤å¯èƒ½éœ€è¦`å‡ ç§’é’Ÿ`æ‰èƒ½æ‰§è¡Œã€‚



## ä¸ä¸€å®šä¼šè¸©çš„å‘
+ pipé•œåƒæºæœ‰è®²ç©¶
```shell
# [global]
# ç”¨è¿™ä¸ªæºæŠ¥é”™ğŸ‘‡
# index-url = https://pypi.doubanio.com/simple
# [install]
# trusted-host = pypi.doubanio.com

[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
```

+ frappeæºç ä¸­çš„ package.json ä¸­æœ‰æŒ‡å‘githubçš„ä¾èµ–ï¼Œå¦‚æœç½‘ç»œæœ‰é—®é¢˜ï¼Œå°±ä¼šå‡ºé—®é¢˜
```shell
"dependencies": {
  â€¦â€¦
  "air-datepicker": "github:frappe/air-datepicker",
  â€¦â€¦
```

+ windows+wslç¯å¢ƒä¸‹ï¼Œwslä¸­æ²¡æœ‰é»˜è®¤éœ€è¦çš„ /var/lib/docker æ–‡ä»¶å¤¹ï¼Œä¸èƒ½æŒ‰å¸¸è§„çš„æŒ‚è½½æ–¹å¼æŒ‚è½½ğŸ‘‡
```shell
  â€¦â€¦  
    volumes:
      # å¸¸è§„æŒ‚è½½æ–¹å¼
      # - mariadb-data:/var/lib/mysql

      # ç›´æ¥æŒ‚åˆ°windowsä¸‹ğŸ‘‡
      # - ..\docker-data\mariadb-data-devcontainer:/var/lib/mysql

      # æŒ‚è½½åˆ°windowsä¸‹ï¼Œæ•°æ®åº“å¯åŠ¨å‡ºé”™ï¼ŒåŒºåˆ†å¤§å°å†™ä»€ä¹ˆçš„ï¼Œæ”¹æˆæŒ‚è½½åˆ°wslä¸­ğŸ‘‡
      - \\wsl$\Ubuntu\home\docker-data\mariadb-data-devcontainer:/var/lib/mysql
  â€¦â€¦
volumes:
  mariadb-data:
```

volumesæŒ‚è½½åˆ°windowsä¸‹æ—¶ï¼Œdockersæ—¥å¿—ä¿¡æ¯
```shell
2024-05-06 10:07:28 0 [Warning] Setting lower_case_table_names=2 because file system for /var/lib/mysql/ is case insensitive
â€¦â€¦
```
è¿™è¡¨ç¤ºMariaDBæ­£åœ¨å°†lower_case_table_namesè®¾ç½®ä¸º2ï¼Œå› ä¸º/var/lib/mysql/æ‰€åœ¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚åœ¨æŸäº›æ“ä½œç³»ç»Ÿï¼ˆå¦‚Windowsæˆ–MacOSï¼‰ä¸Šï¼Œæ–‡ä»¶ç³»ç»Ÿé»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œè€ŒLinuxé€šå¸¸æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚lower_case_table_namesè®¾ç½®ä¼šå½±å“MariaDBå¦‚ä½•å­˜å‚¨å’Œæ¯”è¾ƒè¡¨åã€‚